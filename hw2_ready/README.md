# Отчет о тестировании алгоритма Левенштейна и сравнении критериев покрытия кода

## 1. Введение

Данная работа посвящена тестированию алгоритма вычисления расстояния Левенштейна с использованием различных критериев покрытия кода:
- Statement Coverage (SC)
- Decision Coverage (DC)
- Modified Condition/Decision Coverage (MC/DC)

Основная цель — продемонстрировать иерархию критериев покрытия кода: SC < DC < MC/DC, и показать, что более строгие критерии покрытия могут выявить ошибки, не обнаруживаемые менее строгими критериями.

## 2. Реализация алгоритма Левенштейна

Алгоритм Левенштейна вычисляет минимальное количество операций вставки, удаления и замены, необходимых для преобразования одной строки в другую. Реализация содержит два необязательных параметра оптимизации:

```cpp
unsigned int levenshteinDistance(
    const std::string& s1, 
    const std::string& s2, 
    bool useOptimization, 
    bool useDiagonalOptimization
) {
    // ... реализация алгоритма ...
}
```

Алгоритм использует динамическое программирование с матрицей размером (m+1)×(n+1), где m и n — длины строк s1 и s2 соответственно.

## 3. Критерии покрытия кода

### Statement Coverage (SC)
SC требует выполнения каждой строки кода хотя бы один раз. Для достижения SC необходимо, чтобы все строки исходного кода были выполнены при тестировании.

### Decision Coverage (DC)
DC требует выполнения каждого условия с обоими результатами (true и false). Это более строгий критерий, чем SC, так как требует проверки всех ветвей выполнения.

### Modified Condition/Decision Coverage (MC/DC)
MC/DC требует, чтобы:
1. Каждое условие принимало все возможные значения
2. Каждое условие в составном условии показывало независимое влияние на результат
3. Все точки входа и выхода были выполнены

Это наиболее строгий из трёх рассмотренных критериев.

## 4. Тестирование и анализ покрытия

### 4.1 Statement Coverage
Тесты для SC охватывают основные сценарии использования алгоритма Левенштейна:
- Сравнение одинаковых строк
- Сравнение разных строк
- Сравнение с пустой строкой

```cpp
// Примеры тестов для SC
    assert(levenshteinDistance("", "", true, true) == 0);
    assert(levenshteinDistance("a", "", true, true) == 1);
    assert(levenshteinDistance("", "a", true, true) == 1);
    assert(levenshteinDistance("a", "a", true, true) == 0);
    assert(levenshteinDistance("abc", "abc", true, true) == 0);
```

### 4.2 Decision Coverage
Тесты для DC расширяют SC-тесты и обеспечивают выполнение каждого условия с результатами true и false:

```cpp
// Примеры тестов для DC
// Тест useDiagonalOptimization = true/false
    assert(levenshteinDistance("cat", "cat", true, true) == 0);
    assert(levenshteinDistance("cat", "cat", true, false) == 0);
    
    // Тест условия s1 == s2 (true/false)
    assert(levenshteinDistance("test", "test", true, true) == 0);
    assert(levenshteinDistance("test", "text", true, true) == 1);
    
    // Тест условия s1[i-1] == s2[j-1] (true/false)
    assert(levenshteinDistance("abc", "abc", false, false) == 0);
    assert(levenshteinDistance("abc", "abd", false, false) == 1);
```

### 4.3 Modified Condition/Decision Coverage
Тесты для MC/DC дополнительно проверяют независимое влияние каждого условия в сложных условных выражениях:

```cpp
// Примеры тестов для MC/DC
// MC/DC для условия (useDiagonalOptimization || s1.length() > 10)
    assert(levenshteinDistance("abcdef", "abcdef", false, true) == 0);  // false || false, но совпадающие строки
    assert(levenshteinDistance("abcdefghi", "abcdefghi", false, false) == 0);  // false || false, но совпадающие строки
    assert(levenshteinDistance("abcdefghijklm", "abcdefghijklm", false, false) == 0);  // false || true (длина > 10)
    assert(levenshteinDistance("abcdefghijklm", "abcdefghijxlm", false, false) == 1);  // false || true (длина > 10)
```

## 5. Демонстрация различий между критериями покрытия

Для наглядной демонстрации различий между DC и MC/DC был создан модуль `complex_conditions.cpp` с функциями, которые показывают, что MC/DC тесты могут обнаружить ошибки, невидимые для DC тестов:

```cpp
// Функция с ошибкой в сложном условии
bool buggyFunction(bool A, bool B, bool C) {
    // Должно быть A && (B || C), но реализовано как (A && B) || C
    return (A && B) || C;
}

// Правильная функция для сравнения
bool correctFunction(bool A, bool B, bool C) {
    return A && (B || C);
}
```

DC тесты проверяют только исходы условия:
```cpp
assert(buggyFunction(true, true, false) == true);   // A=T, B=T, C=F
assert(buggyFunction(false, true, false) == false); // A=F, B=T, C=F
```

MC/DC тесты дополнительно выявляют ошибку благодаря проверке независимого влияния условий:
```cpp
bool A = false, B = false, C = true;
bool correctResult = correctFunction(A, B, C);  // false
bool buggyResult = buggyFunction(A, B, C);      // true — ошибка обнаружена!
```

## 6. Анализ покрытия с использованием различных инструментов

### 6.1 Анализ с GCC/gcov
Анализ покрытия с использованием gcov показал:
- SC тесты: 100% покрытия строк
- DC тесты: 100% покрытия строк, ~86% покрытия ветвей
- MC/DC тесты: 100% покрытия строк, ~88% покрытия ветвей

Интересно, что gcov показывает некоторые "непокрытые ветви" даже при MC/DC:
```
src/levenshtein.cpp  36 ветвлений, 32 пройдены (88% покрытие)
Не покрыты строки 25, 45, 48
```

Это связано с особенностями инструментирования gcov, который считает некоторые операции "ветвлениями", хотя они не являются явными ветвлениями в коде.

### 6.2 Анализ с Clang
Для более точного анализа мы использовали инструменты Clang:

**DC тесты:**
```
src/levenshtein.cpp  24 ветви, 1 непокрытая (95.83% покрытие)
```

**MC/DC тесты:**
```
src/levenshtein.cpp  24 ветви, 0 непокрытых (100% покрытие)
```

Это подтверждает, что MC/DC тесты обеспечивают более полное покрытие, чем DC тесты.

## 7. Сравнение отчетов Clang

HTML-отчеты Clang позволяют визуально увидеть различия в покрытии:
- В отчете DC: некоторые части сложных условий не покрыты полностью
- В отчете MC/DC: все части сложных условий полностью покрыты

## 8. Результаты экспериментов

### 8.1 Statement Coverage (SC) с GCC

```
--- Отчет о Statement Coverage ---
File                                       Lines    Exec  Cover   Missing
------------------------------------------------------------------------------
src/complex_conditions.cpp                     6       0     0%   3-4,7,10,13,15
src/levenshtein.cpp                           23      23   100%
tests/sc_tests.cpp                            23      23   100%
------------------------------------------------------------------------------
TOTAL                                         52      46    88%
```

Как видно, наши SC тесты обеспечивают 100% покрытие строк для алгоритма Левенштейна.

### 8.2 Decision Coverage (DC) с GCC

```
--- Отчет о Decision Coverage ---
File                                    Branches   Taken  Cover   Missing
------------------------------------------------------------------------------
src/complex_conditions.cpp                    18       0     0%   4,10,15
src/levenshtein.cpp                           36      31    86%   25,42,45,48
------------------------------------------------------------------------------
```

DC тесты показывают 86% покрытия ветвей для алгоритма Левенштейна.

### 8.3 Modified Condition/Decision Coverage (MC/DC) с GCC

```
--- Отчет о MC/DC Coverage ---
File                                    Branches   Taken  Cover   Missing
------------------------------------------------------------------------------
src/complex_conditions.cpp                    18       0     0%   4,10,15
src/levenshtein.cpp                           36      32    88%   25,45,48
------------------------------------------------------------------------------
```

MC/DC тесты увеличивают покрытие ветвей до 88%.

### 8.4 Сравнение DC и MC/DC с использованием Clang

#### Decision Coverage с Clang:

```
--- Отчет о DC Coverage с использованием Clang ---
Filename                    Lines    Cover    Branches    Missed Branches    Cover
-----------------------------------------------------------------------------
src/levenshtein.cpp          34     100.00%      24              1          95.83%
```

#### MC/DC Coverage с Clang:

```
--- Отчет о MC/DC Coverage с использованием Clang ---
Filename                    Lines    Cover    Branches    Missed Branches    Cover
-----------------------------------------------------------------------------
src/levenshtein.cpp          34     100.00%      24              0          100.00%
```

Важное наблюдение: **Clang показывает, что MC/DC тесты покрывают 100% ветвей, в то время как DC тесты оставляют одну ветвь непокрытой (95.83%).**

### 8.5 Демонстрация превосходства MC/DC над DC

Вывод программы при запуске `make dc-mc-proof`:

```
-- ПРОВЕРКА РАЗНИЦЫ МЕЖДУ DC И MC/DC ТЕСТАМИ --

1. Тестирование с Decision Coverage (DC):
Decision Coverage тесты пройдены успешно!

2. Тестирование с MC/DC Coverage:
Проверка критического случая, где проявляется ошибка:
A=0, B=0, C=1
- Корректная функция A&&(B||C): 0
- Ошибочная функция (A&&B)||C: 1
MC/DC тесты обнаружили ошибку в buggyFunction, которую не обнаружили DC тесты!

-- ВЫВОД --
DC тесты не нашли ошибку в сложном условии.
MC/DC тесты обнаружили ошибку, потому что проверяют каждое условие отдельно.
Это показывает, что MC/DC лучше, чем DC.
```

Как видно из результатов, MC/DC тесты способны обнаружить ошибки в сложных условиях, которые пропускаются при использовании DC тестов. 

Это происходит потому, что DC тесты проверяют только общее условие на true/false, а MC/DC тесты дополнительно проверяют независимое влияние каждой части сложного условия.

## 9. Выводы

1. **Иерархия критериев покрытия** SC < DC < MC/DC подтверждена как теоретически, так и практически.

2. **Инструменты анализа покрытия**: Clang предоставляет более точный анализ MC/DC покрытия по сравнению с GCC/gcov.

3. **Практическая значимость**: MC/DC тесты могут обнаруживать ошибки в сложных условиях, которые пропускаются DC тестами.

4. **Критичность для безопасности**: Для критически важных систем (авионика, медицинские устройства) выбор критерия покрытия имеет решающее значение. MC/DC является предпочтительным, хотя и более трудоемким.

## 10. Инструкции по тестированию

### 10.1 Требования

Для воспроизведения экспериментов необходимы:
- g++ с поддержкой C++11 и gcov (для GCC тестов)
- Clang++ с поддержкой инструментирования покрытия (для Clang тестов)
- llvm-profdata и llvm-cov (для анализа покрытия с Clang)
- gcovr (для генерации отчетов о покрытии с GCC)
- make

### 10.2 Запуск тестов

#### Тестирование Statement Coverage (SC):
```bash
make sc  # Запуск тестов SC 
```

#### Тестирование Decision Coverage (DC):
```bash
make dc  # Запуск тестов DC
```

#### Тестирование Modified Condition/Decision Coverage (MC/DC):
```bash
make mcdc  # Запуск тестов MC/DC
```

#### Демонстрация преимущества MC/DC над DC:
```bash
make dc-mc-proof  # Показывает конкретный пример, где MC/DC превосходит DC
```

### 10.3 Запуск тестов с использованием Clang

```bash
make clang-dc  # Запуск DC тестов с использованием Clang
make clang-mcdc  # Запуск MC/DC тестов с использованием Clang
```

Результаты тестирования будут доступны:
- HTML-отчеты в директории `reports/`
- Таблицы сравнения в выводе консоли
